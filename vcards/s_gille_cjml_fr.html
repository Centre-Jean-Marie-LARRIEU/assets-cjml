<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Contact - Sébastien GILLE</title>
    <link rel="icon" href="https://Centre-Jean-Marie-LARRIEU.github.io/assets-cjml/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ... (Votre CSS existant ici, inchangé) ... */
    </style>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2MWWE56469"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}

      // Commande de base pour configurer le dataLayer avec la date actuelle.
      // Elle est poussée dans la file d'attente et sera traitée par gtag.js une fois chargé.
      gtag('js', new Date());

      // Initialiser le consentement à 'denied' par défaut avant tout.
      // Cela bloque toutes les mesures tant que le consentement n'est pas explicite.
      gtag('consent', 'default', {
        'analytics_storage': 'denied',
        'ad_storage': 'denied',
        'wait_for_update': 500 // Temps d'attente pour la mise à jour du consentement
      });

      // --- LOGIQUE DE CONSENTEMENT ET INITIALISATION GA ---
      const GA4_MEASUREMENT_ID = 'G-2MWWE56469'; // Votre ID GA4
      const CONSENT_COOKIE_NAME = 'cjml_ga_consent'; // Nom du cookie de consentement

      // Fonction pour mettre à jour le consentement et initialiser GA
      function updateConsentAndInitializeGA(consentStatus) {
        localStorage.setItem(CONSENT_COOKIE_NAME, consentStatus);
        document.getElementById('cookieConsentBanner')?.classList.remove('show');

        if (consentStatus === 'granted') {
          // Si le consentement est donné, mettre à jour le consentement GA
          gtag('consent', 'update', {
            'analytics_storage': 'granted',
            'ad_storage': 'granted' // Ad_storage peut aussi être 'granted' ou 'denied' selon votre politique.
                                    // Si vous ne faites pas de pub, 'denied' est plus sûr.
          });
          
          // Maintenant que le consentement est donné, envoyer les commandes config et set.
          // gtag('set') est poussé dans dataLayer et s'appliquera à tous les hits suivants.
          gtag('set', { 'card_user_name': 'Sébastien GILLE' });
          // gtag('config') envoie le page_view initial et configure la propriété.
          gtag('config', GA4_MEASUREMENT_ID);

          console.log('Google Analytics initialisé (consentement accordé).');
          setupGAEventListeners(); // Attacher les écouteurs pour les clics
        } else {
          // Si le consentement est refusé, s'assurer que GA ne collecte rien
          gtag('consent', 'update', {
            'analytics_storage': 'denied',
            'ad_storage': 'denied'
          });
          console.log('Google Analytics désactivé (consentement refusé).');
        }
      }

      // --- GESTION DU BANDEAU DE CONSENTEMENT AU CHARGEMENT DU DOM ---
      document.addEventListener('DOMContentLoaded', function() {
        const consentBanner = document.getElementById('cookieConsentBanner');
        const acceptButton = document.getElementById('acceptCookies');
        const denyButton = document.getElementById('denyCookies');

        const savedConsent = localStorage.getItem(CONSENT_COOKIE_NAME);

        if (!savedConsent) {
          // Afficher le bandeau si aucun consentement n'a été enregistré
          setTimeout(() => {
            consentBanner?.classList.add('show');
          }, 500); 
        } else {
          // Si un consentement est déjà enregistré, l'appliquer immédiatement
          updateConsentAndInitializeGA(savedConsent);
        }

        // Attacher les écouteurs de clic pour les boutons du bandeau
        acceptButton?.addEventListener('click', function() {
          updateConsentAndInitializeGA('granted');
        });

        denyButton?.addEventListener('click', function() {
          updateConsentAndInitializeGA('denied');
        });
      });

      // setupGAEventListeners reste inchangée, elle est appelée après l'initialisation de GA
      function setupGAEventListeners() {
          const userName = 'Sébastien GILLE';

          function sendButtonClickEvent(category, label, text) {
              // Vérification supplémentaire pour s'assurer que gtag est bien là avant l'appel
              if (typeof window.gtag === 'function') {
                  gtag('event', 'button_click', {
                      'event_category': category,
                      'event_label': label + ' - ' + userName,
                      'button_text': text
                  });
                  console.log('GA Event Sent: ', category, label, text);
              } else {
                  // Cette alerte ne devrait plus apparaître si la logique est correcte.
                  console.warn('Erreur: gtag n\'est pas disponible pour envoyer l\'événement de clic. Commande non envoyée.');
              }
          }

          document.getElementById('saveContactButton')?.addEventListener('click', function() {
              sendButtonClickEvent('Carte de Visite', 'Enregistrer Contact', 'Enregistrer dans mes Contacts');
          });
          document.getElementById('qrCodeSmallButton')?.addEventListener('click', function() {
              sendButtonClickEvent('Carte de Visite', 'Afficher QR Code', 'Scannez ma carte');
          });
          document.getElementById('shareButton')?.addEventListener('click', function() {
              sendButtonClickEvent('Carte de Visite', 'Ouvrir Partage', 'Partager');
          });
          document.getElementById('qrOverlayLinkButton')?.addEventListener('click', function() {
              sendButtonClickEvent('Carte de Visite', 'Lien Page Complete QR Overlay', 'Accéder à la page complète');
          });
          document.getElementById('nativeShareButton')?.addEventListener('click', function() {
              sendButtonClickEvent('Carte de Visite', 'Partager Natif', 'Partager (appareil)');
          });
          document.getElementById('emailShareButton')?.addEventListener('click', function() {
              sendButtonClickEvent('Carte de Visite', 'Partager Email', 'Envoyer par Email');
          });
          document.getElementById('copyLinkShareButton')?.addEventListener('click', function() {
              sendButtonClickEvent('Carte de Visite', 'Copier Lien Partage', 'Copier le lien');
          });

          const actionButtonsContainer = document.getElementById('actionButtonsContainer');
          if (actionButtonsContainer) {
              actionButtonsContainer.querySelectorAll('a.button, button.button').forEach(button => {
                  const buttonText = button.textContent.trim() || button.getAttribute('data-analytics-label') || 'Action Button';
                  button.addEventListener('click', function() {
                      sendButtonClickEvent('Carte de Visite - Actions', buttonText, buttonText);
                  });
              });
          }
          console.log('Écouteurs d\'événements GA attachés.');
      }
    </script>
</head>
<body>
    <div class="card">
        <img src="https://raw.githubusercontent.com/Centre-Jean-Marie-LARRIEU/assets-cjml/main/logo-horizontal.jpg" alt="Logo" class="logo">
        <h1>Sébastien GILLE</h1>
        <p class="title">Responsable Système d'Information</p>
        <a href="data:text/vcard;charset=utf-8,BEGIN%3AVCARD%0AVERSION%3A3.0%0AN%3AGILLE%3BS%C3%A9bastien%3B%3B%3B%0AFN%3AS%C3%A9bastien%20GILLE%0AORG%3ACentre%20Jean-Marie%20LARRIEU%0ATITLE%3AResponsable%20Syst%C3%A8me%20d%27Information%0ATEL%3Btype%3DCELL%2Cvoice%3A%2B33777685533%0AEMAIL%3Btype%3DINTERNET%3Btype%3DWORK%3Btype%3Dpref%3As.gille%40cjml.fr%0AADR%3Btype%3DWORK%3A%3B%3B414%20Rue%20du%20Layris%5Cn65710%20CAMPAN%3B%3B%3B%3B%0AEND%3AVCARD" download="Sébastien_GILLE.vcf" class="button primary" id="saveContactButton">Enregistrer dans mes Contacts</a>
        <hr>
        <div class="contact-info">
            <div class="contact-item"><span class="label">Mobile</span><a href="tel:+33777685533">07 77 68 55 33</a></div><div class="contact-item"><span class="label">Téléphone (Centre)</span><a href="tel:+33562913250">05 62 91 32 50</a></div><div class="contact-item"><span class="label">Email</span><a href="mailto:s.gille@cjml.fr">s.gille@cjml.fr</a></div><div class="contact-item">
    <span class="label">Site Web</span>
    <a href="http://www.cjml.fr" target="_blank" rel="noopener noreferrer" style="color: var(--primary-blue); text-decoration: underline;">www.cjml.fr</a>
</div><div class="contact-item">
    <span class="label">Siège Social</span>
    <a href="https://www.google.com/maps/search/?api=1&query=414+Rue+du+Layris+-+65710+CAMPAN" target="_blank" rel="noopener noreferrer">414 Rue du Layris - 65710 CAMPAN</a>
</div>
        </div>
        <div class="action-buttons" id="actionButtonsContainer">
            <a href="tel:+33777685533" class="button secondary trackable-action-button" data-analytics-label="Appeler (Mobile)">Appeler (Mobile)</a><a href="tel:+33562913250" class="button secondary trackable-action-button" data-analytics-label="Appeler (Centre)">Appeler le Centre</a><a href="mailto:s.gille@cjml.fr" class="button secondary trackable-action-button" data-analytics-label="Envoyer Email">Envoyer un Email</a><a href="https://www.google.com/maps/search/?api=1&query=414+Rue+du+Layris+-+65710+CAMPAN" target="_blank" class="button secondary trackable-action-button" data-analytics-label="Itinéraire">Itinéraire</a>
        </div>

        <div class="bottom-actions-container">
            <div class="qr-code-small-container" id="qrCodeSmallButton" onclick="showQrCodeOverlay()">
                <img src="https://Centre-Jean-Marie-LARRIEU.github.io/assets-cjml/qrcodes/s_gille_cjml_fr.png" alt="QR Code" class="qr-code-small">
                <span class="qr-code-text">Scannez<br>ma carte</span>
            </div>

            <div class="share-button-container">
                <button class="share-main-button" id="shareButton" onclick="showShareOverlay()">Partager</button>
            </div>
        </div>
    </div>

    <footer class="page-footer">
        <a href="mentions-legales.html">Mentions Légales & Politique de Confidentialité</a>
    </footer>

    <div id="qrOverlay" class="qr-overlay" onclick="hideQrCodeOverlay(event)">
        <div class="qr-overlay-content" onclick="event.stopPropagation()">
            <button class="qr-overlay-close" onclick="hideQrCodeOverlay(event)">×</button>
            <img id="qrOverlayImg" src="https://Centre-Jean-Marie-LARRIEU.github.io/assets-cjml/qrcodes/s_gille_cjml_fr.png" alt="QR Code" class="qr-overlay-img">
            <p class="qr-overlay-text">Scannez ce QR Code pour accéder à la carte de visite de <br><b>Sébastien GILLE</b></p>
            <p><a href="https://Centre-Jean-Marie-LARRIEU.github.io/assets-cjml/vcards/s_gille_cjml_fr.html" target="_blank" class="button primary" style="width: auto; padding: 10px 20px; margin-top: 10px;" id="qrOverlayLinkButton">Accéder à la page complète</a></p>
        </div>
    </div>

    <div id="shareOverlay" class="share-overlay" onclick="hideShareOverlay(event)">
        <div class="share-overlay-content" onclick="event.stopPropagation()">
            <button class="share-overlay-close" onclick="hideShareOverlay(event)">×</button>
            <p class="qr-overlay-text" style="margin-bottom: 0;">Partager la carte de visite de <br><b>Sébastien GILLE</b></p>
            <div class="share-options-menu">
                <button class="share-option-button" id="nativeShareButton" onclick="handleNativeShare()">Partager (appareil)</button>
                <a href="mailto:?subject=Carte de Visite de Sébastien GILLE&body=Découvrez la carte de visite numérique de Sébastien GILLE : https://Centre-Jean-Marie-LARRIEU.github.io/assets-cjml/vcards/s_gille_cjml_fr.html" class="share-option-button" id="emailShareButton">Envoyer par Email</a>
                <button class="share-option-button" id="copyLinkShareButton" onclick="copyLink()">Copier le lien</button>
            </div>
        </div>
    </div>

    <div id="cookieConsentBanner">
        <p>Ce site utilise des cookies à des fins de mesure d'audience anonymisée. Acceptez-vous leur dépôt ?</p>
        <div class="consent-buttons">
            <button class="consent-button" id="acceptCookies">Accepter</button>
            <button class="consent-button deny" id="denyCookies">Refuser</button>
            <a href="mentions-legales.html" class="consent-button deny" style="text-decoration: none; text-align: center;">En savoir plus</a>
        </div>
    </div>

    <script>
        // Fonctions existantes pour les overlays
        function showQrCodeOverlay() {
            const overlay = document.getElementById('qrOverlay');
            overlay.classList.add('visible');
            document.body.style.overflow = 'hidden';
            document.getElementById('shareOverlay').classList.remove('visible');
        }

        function hideQrCodeOverlay(event) {
            if (event.target.id === 'qrOverlay' || event.target.classList.contains('qr-overlay-close')) {
                const overlay = document.getElementById('qrOverlay');
                overlay.classList.remove('visible');
                document.body.style.overflow = '';
            }
        }

        function showShareOverlay() {
            const overlay = document.getElementById('shareOverlay');
            overlay.classList.add('visible');
            document.body.style.overflow = 'hidden';
            document.getElementById('qrOverlay').classList.remove('visible');
        }

        function hideShareOverlay(event) {
            if (event.target.id === 'shareOverlay' || event.target.classList.contains('share-overlay-close')) {
                const overlay = document.getElementById('shareOverlay');
                overlay.classList.remove('visible');
                document.body.style.overflow = '';
            }
        }

        async function handleNativeShare() {
            const shareData = {
                title: 'Carte de Visite Numérique de Sébastien GILLE',
                text: 'Découvrez la carte de visite numérique de Sébastien GILLE : https://Centre-Jean-Marie-LARRIEU.github.io/assets-cjml/vcards/s_gille_cjml_fr.html',
                url: 'https://Centre-Jean-Marie-LARRIEU.github.io/assets-cjml/vcards/s_gille_cjml_fr.html'
            };

            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                    console.log('Partage natif réussi');
                } catch (err) {
                    console.log('Erreur de partage natif ou annulé: ', err);
                } 
            } else {
                alert("La fonction de partage native n'est pas disponible sur votre appareil/navigateur. Veuillez utiliser 'Envoyer par Email' ou 'Copier le lien'.");
            }
            hideShareOverlay();
        }

        function copyLink() {
            const linkToCopy = 'https://Centre-Jean-Marie-LARRIEU.github.io/assets-cjml/vcards/s_gille_cjml_fr.html';
            navigator.clipboard.writeText(linkToCopy).then(() => {
                alert("Lien copié dans le presse-papiers !");
                console.log('Lien copié: ', linkToCopy);
            }).catch(err => {
                console.error('Erreur lors de la copie du lien: ', err);
                const textArea = document.createElement("textarea");
                textArea.value = linkToCopy;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    const msg = successful ? 'Lien copié dans le presse-papiers !' : 'Erreur lors de la copie du lien.';
                    alert(msg);
                } catch (err) {
                    alert("Impossible de copier le lien. Veuillez le copier manuellement depuis la barre d'adresse : " + linkToCopy);
                }
                document.body.removeChild(textArea);
            }).finally(() => {
                hideShareOverlay();
            });
        }

        // --- SCRIPT DE GESTION DU CONSENTEMENT ET GOOGLE ANALYTICS (CE BLOC EST DÉJÀ DANS LE HEAD) ---
        // Le code ici est un DUPLICAT de ce qui est dans le HEAD et ne devrait pas être ici.
        // Je le laisse vide pour éviter les erreurs de duplication, car la logique est gérée en haut.
    </script>
</body>
</html>